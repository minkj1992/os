# [CH09] 스케줄링 알고리즘과 우선순위

## 프로세스의 스케줄링
- Real Time OS
    - 바로바로
    - 응답성
    - 스타트가 빠르다 골인지점에 빠르게 도착하는지는 알 수 없다.
- Time Slice
    - OS는 내부적인 Clock을 통해 시간의 단위를 구분짓는다.
    - 시스템 관점에서 Time Slice는 x클럭, 일반적인 개발자 입장에서의 Time Slice는 x m초이다.
    - 타임슬라이스가 3초라고 한다면, 3초당 한번씩 프로세스의 실행주기가 바뀐다.
- 일반 OS와 Real Time OS의 차이점
    - 결정적 차이가 스케줄러
        - 선점형 OS (일반OS)
            - 우선순위가 높은 작업이 들어오면, 타임슬라이스 정도의 처리는 소모하고 높은 우선순위의 작업으로 Context Switchingg시켜준다.
        - 비선점형 OS (리얼타임OS)
            - 우선순위가 높은 작업이 들어올 때, 기다리라고 하는것이 비선점형 OS
            - 기존에 작업하던 프로세스가 명시적으로 yield하겠다고 알려야 Context Switching이 일어난다.
            - 우선순위에 대한 판단은  스케줄러가 해주지만 context Switching에 대한 권한은 현재 실행되고 있는 프로세스에 포함되어 있다.
    - Time Slice 길이
        - 길다(일반OS)
        - 짧다(RT OS) -> 반응성이 좋다.

## 스케줄링 알고리즘
> 평등과 특권의 공존
- 평등원칙과 특권원칙
    - 동일한 우선순위에 대해서는 평등 ( RR 알고리즘, 라운드 로빈 )
    - 높은 우선순위에 대해서는 우선순위 기반 알고리즘 (우선순위 알고리즘)

- 0~9 우선순위에 대하여 메모리블럭을 구성하고 이 안에 Priority Queue들을 넣어준다.
    - Priority  Queue는 Linked-List를 대표적으로 구성된다. (RR)
    - 이를 구성하는 Node들은 프로세스로 구성된다.

- 실행방법
    1. 높은 우선순위의 Priority Queue를 살펴본다.
        - 해당 우선순위의 Task에 대해서는 우선순위 알고리즘을 적용하고, 그 안의 동일 우선순위 Tasks에게는 RR 알고리즘을 적용한다.
        - 매 Time Slice마다 해당 큐에 존재하는 프로세스들을 RR에 의거하여 context switching 시킨다.
        - 이때 비교적 낮은 우선순위의 priority queue들의 task는 실행되지 않고 대기한다.
        - **그런데 우선순위 낮은 프로세스와 높은 프로세스를 두고 실행해 보았을때, 낮은 프로세스가 중간중간 실행되는 이유는?**
            - **I/O bound 작업을 높은 우선순위에 포함된 프로세스가 진행할 경우, 이때는 CPU가 필요없는 작업이기 때문에 프로세스가 blocking 모드로 빠져버린다. 이때 우선순위가 낮은 프로세스가 실행권을 가지게 된다.**
            - 만약 높은 우선순위를 지닌 Priority Queue에 5개의 프로세스들이 존재할 경우, 이 중 하나의 프로세스가 I/O task를 진행하여 blocking되었다 하더라도 나머지 4개의 프로세스가 종료/block되어야 낮은 우선순위의 task가 진행 될 수 있다.

- 스케줄링 진행시점 ( 3 )
    1. 매 타임 슬라이스 마다
        - 이때 매 타임 슬라이스 사이에서도 컨텍스트 스위칭이 발생할 수 있는가? 
            - Yes 라면: 너무 자주 context switching이 일어나면, ct overhead가 일어난다. 이때는 TS를 넓게 잡아주어야 한다. 다만 그리한다면 반응성이 떨어지게 된다.
            - No 라면: TS가 좁고 반응성을 잡아주기 위해서는 
    2. 프로세스가 생성 및 소멸될 때마다
        - 생성/소멸일 경우 스케줄러를 update 해주어야 한다.
    3. 현재 실행중인 프로세스가 블로킹 상태에 놓일때마다
        - I/O bound task를 진행할때 blocked 될때

최소한으로 스케줄러가 동작을 하기위해서 스케줄링의 철학이 구성되어 있다.

- `프로세스의 우선순위 계층`


